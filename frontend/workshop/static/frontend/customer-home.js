import{r as o,j as e,c as y}from"./main.DfWLdBbX.js";function w(a,n="customer"){const[l,s]=o.useState(!1),[r,c]=o.useState([]),t=o.useRef(null),i=o.useRef(null),u=()=>{if(t.current?.readyState===WebSocket.OPEN)return;const N=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws/workshop/${n}/`;t.current=new WebSocket(N),t.current.onopen=()=>{console.log("🔌 WebSocket connected"),s(!0),g()},t.current.onmessage=d=>{try{const m=JSON.parse(d.data);console.log("📨 WebSocket message:",m),c(v=>[...v,m])}catch(m){console.error("Error parsing WebSocket message:",m)}},t.current.onclose=d=>{console.log("❌ WebSocket disconnected:",d.code),s(!1),f(),setTimeout(()=>{console.log("🔄 Attempting to reconnect..."),u()},3e3)},t.current.onerror=d=>{console.error("WebSocket error:",d),s(!1)}},g=()=>{i.current=setInterval(()=>{t.current?.readyState===WebSocket.OPEN&&t.current.send(JSON.stringify({type:"ping",timestamp:Date.now()}))},3e4)},f=()=>{i.current&&(clearInterval(i.current),i.current=null)},j=h=>{t.current?.readyState===WebSocket.OPEN?t.current.send(JSON.stringify(h)):console.warn("WebSocket not connected, cannot send message")};return o.useEffect(()=>(u(),()=>{f(),t.current&&t.current.close()}),[a,n]),{isConnected:l,messages:r,sendMessage:j,connect:u}}function S(){const[a,n]=o.useState({activeRepairs:0,totalRepairs:0,notifications:0}),{isConnected:l,messages:s}=w(null,"customer");return o.useEffect(()=>{fetch("/api/customer/stats/").then(r=>r.json()).then(r=>n(r)).catch(r=>console.error("Error fetching stats:",r))},[]),o.useEffect(()=>{s.forEach(r=>{r.type==="repair_status_update"&&fetch("/api/customer/stats/").then(c=>c.json()).then(c=>n(c))})},[s]),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:[e.jsx("div",{className:"bg-slate-800/30 backdrop-blur-md border-b border-slate-700",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500/20 rounded-xl flex items-center justify-center",children:e.jsx("i",{className:"fas fa-bicycle text-blue-400"})}),e.jsx("h1",{className:"text-xl font-bold text-white",children:"אופני יקיר"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${l?"bg-green-400":"bg-red-400"}`}),e.jsx("span",{className:"text-sm text-slate-400",children:l?"מחובר":"מנותק"})]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8 animate-fade-in",children:[e.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:"שלום! 👋"}),e.jsx("p",{className:"text-slate-400 text-lg",children:"ברוכים הבאים למערכת ניהול התיקונים"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(x,{icon:"fas fa-tools",title:"תיקונים פעילים",value:a.activeRepairs,color:"blue",className:"animate-slide-up",style:{animationDelay:"0.1s"}}),e.jsx(x,{icon:"fas fa-history",title:"סה״כ תיקונים",value:a.totalRepairs,color:"purple",className:"animate-slide-up",style:{animationDelay:"0.2s"}}),e.jsx(x,{icon:"fas fa-bell",title:"התראות חדשות",value:a.notifications,color:"green",className:"animate-slide-up",style:{animationDelay:"0.3s"}})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsx(b,{icon:"fas fa-plus-circle",title:"דיווח תיקון חדש",description:"דווח על תקלה באופניים שלך",href:"/customer/report/",color:"bg-gradient-to-br from-blue-500 to-blue-600",className:"animate-scale-in",style:{animationDelay:"0.4s"}}),e.jsx(b,{icon:"fas fa-list-alt",title:"הלוח האישי שלי",description:"צפה בכל התיקונים וההתראות",href:"/customer/dashboard/",color:"bg-gradient-to-br from-purple-500 to-purple-600",className:"animate-scale-in",style:{animationDelay:"0.5s"}})]}),e.jsxs("div",{className:"card-mercury animate-fade-in",style:{animationDelay:"0.6s"},children:[e.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-clock text-blue-400"}),"פעילות אחרונה"]}),e.jsx("div",{className:"text-slate-400",children:e.jsx("p",{children:"עדכונים אחרונים יופיעו כאן בזמן אמת"})})]})]})]})}function x({icon:a,title:n,value:l,color:s,className:r,style:c}){const t={blue:"from-blue-500/20 to-blue-600/20 border-blue-500/30",purple:"from-purple-500/20 to-purple-600/20 border-purple-500/30",green:"from-green-500/20 to-green-600/20 border-green-500/30"},i={blue:"text-blue-400",purple:"text-purple-400",green:"text-green-400"};return e.jsx("div",{className:`bg-gradient-to-br ${t[s]} backdrop-blur-sm border rounded-xl p-6 ${r}`,style:c,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-300 text-sm mb-1",children:n}),e.jsx("p",{className:`text-3xl font-bold ${i[s]}`,children:l})]}),e.jsx("div",{className:`w-12 h-12 bg-gradient-to-br ${t[s]} rounded-xl flex items-center justify-center`,children:e.jsx("i",{className:`${a} ${i[s]} text-xl`})})]})})}function b({icon:a,title:n,description:l,href:s,color:r,className:c,style:t}){return e.jsx("a",{href:s,className:`block ${r} hover:scale-105 rounded-xl p-6 shadow-lg hover:shadow-xl transition-all duration-200 ${c}`,style:t,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx("i",{className:`${a} text-white text-xl`})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xl font-bold text-white mb-2",children:n}),e.jsx("p",{className:"text-white/80",children:l})]})]})})}const p=document.getElementById("customer-home-root");p&&y.createRoot(p).render(e.jsx(S,{}));
