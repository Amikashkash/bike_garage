<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×‘×“×™×§×ª ××¢×¨×›×ª × ×™×”×•×œ ×”×ª×§×™×¢×•×ª - ×“××• ××œ×</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <style>
        body {
            direction: rtl;
            text-align: right;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .demo-section {
            margin: 30px 0;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: #f8f9fa;
        }
        
        .success-box {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
        }
        
        .test-pass {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .test-fail {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .demo-button {
            margin: 5px;
            padding: 10px 20px;
        }
        
        .status-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            margin: 2px;
        }
        
        .status-stuck {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-working {
            background: #d4edda;
            color: #155724;
        }
        
        .demo-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background: white;
        }
        
        .manager-alert {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">
            <i class="bi bi-tools"></i>
            ×‘×“×™×§×ª ××¢×¨×›×ª × ×™×”×•×œ ×”×ª×§×™×¢×•×ª - ×“××• ××œ×
        </h1>
        
        <!-- ×¡×˜×˜×•×¡ ××¢×¨×›×ª -->
        <div class="demo-section">
            <h3><i class="bi bi-gear-fill"></i> ×‘×“×™×§×ª ×¡×˜×˜×•×¡ ×”××¢×¨×›×ª</h3>
            <div id="systemStatus">
                <button class="btn btn-primary demo-button" onclick="checkSystemStatus()">
                    <i class="bi bi-check-circle"></i> ×‘×“×•×§ ×¡×˜×˜×•×¡ ××¢×¨×›×ª
                </button>
                <div id="systemResults"></div>
            </div>
        </div>
        
        <!-- ×“××• ××›×•× ××™ -->
        <div class="demo-section">
            <h3><i class="bi bi-person-gear"></i> ×××©×§ ××›×•× ××™ - × ×™×”×•×œ ×”×ª×§×™×¢×•×ª</h3>
            <p>×”×“××• ××¦×™×’ ×›×™×¦×“ ××›×•× ××™ ×™×›×•×œ ×œ×¡××Ÿ ×ª×™×§×•×Ÿ ×›×ª×§×•×¢ ×•×œ×—×–×•×¨ ×œ×¢×‘×•×“×” ×¨×’×™×œ×”.</p>
            
            <div class="demo-card">
                <h5>×ª×™×§×•×Ÿ ×“××• #1: ××•×¤× ×™×™× ×”×¨××™×™×</h5>
                <p><strong>×œ×§×•×—:</strong> ×™×•×¡×™ ×›×”×Ÿ | <strong>×“×’×:</strong> Trek Mountain Bike</p>
                <p><strong>×ª×™××•×¨:</strong> ×‘×¢×™×” ×‘×”×™×œ×•×›×™× ×•×©×¨×©×¨×ª ××ª× ×ª×§×ª</p>
                
                <div class="d-flex gap-2 mt-3">
                    <button class="btn btn-success demo-button" onclick="updateStatus('working', 1)">
                        <i class="bi bi-check-circle-fill"></i> ×¢×•×‘×“ ×›×¨×’×™×œ
                    </button>
                    <button class="btn btn-danger demo-button" onclick="showStuckModal(1)">
                        <i class="bi bi-x-circle-fill"></i> ×ª×§×•×¢
                    </button>
                </div>
                
                <div id="status1" class="mt-2"></div>
            </div>
            
            <div class="demo-card">
                <h5>×ª×™×§×•×Ÿ ×“××• #2: ××•×¤× ×™ ×›×‘×™×©</h5>
                <p><strong>×œ×§×•×—:</strong> ×¨×—×œ ×œ×•×™ | <strong>×“×’×:</strong> Giant Road Bike</p>
                <p><strong>×ª×™××•×¨:</strong> ×‘×¢×™×” ×‘×‘×œ××™× ×•××™×–×•×Ÿ ×’×œ×’×œ×™×</p>
                
                <div class="d-flex gap-2 mt-3">
                    <button class="btn btn-success demo-button" onclick="updateStatus('working', 2)">
                        <i class="bi bi-check-circle-fill"></i> ×¢×•×‘×“ ×›×¨×’×™×œ
                    </button>
                    <button class="btn btn-danger demo-button" onclick="showStuckModal(2)">
                        <i class="bi bi-x-circle-fill"></i> ×ª×§×•×¢
                    </button>
                </div>
                
                <div id="status2" class="mt-2"></div>
            </div>
        </div>
        
        <!-- ×“××• ×× ×”×œ -->
        <div class="demo-section">
            <h3><i class="bi bi-person-badge"></i> ×××©×§ ×× ×”×œ - × ×™×”×•×œ ×”×ª×¨××•×ª</h3>
            <p>×”×“××• ××¦×™×’ ×›×™×¦×“ ×× ×”×œ ×¨×•××” ×”×ª×¨××•×ª ×¢×œ ×ª×™×§×•× ×™× ×ª×§×•×¢×™× ×•×™×›×•×œ ×œ×”×’×™×‘.</p>
            
            <div id="managerAlerts">
                <!-- ×”×ª×¨××•×ª ×™×•×¦×’×• ×›××Ÿ ×“×™× ××™×ª -->
            </div>
            
            <button class="btn btn-info demo-button" onclick="refreshManagerView()">
                <i class="bi bi-arrow-clockwise"></i> ×¨×¢× ×Ÿ ×ª×¦×•×’×ª ×× ×”×œ
            </button>
        </div>
        
        <!-- ×‘×“×™×§×ª ×ª×§×©×•×¨×ª -->
        <div class="demo-section">
            <h3><i class="bi bi-chat-dots"></i> ×‘×“×™×§×ª ×ª×§×©×•×¨×ª ××›×•× ××™-×× ×”×œ</h3>
            <p>×‘×“×™×§×” ××œ××” ×©×œ ×–×¨×™××ª ×”××™×“×¢ ×‘×™×Ÿ ××›×•× ××™ ×œ×× ×”×œ.</p>
            
            <button class="btn btn-warning demo-button" onclick="runFullFlowTest()">
                <i class="bi bi-play-circle"></i> ×”×¨×¥ ×‘×“×™×§×” ××œ××”
            </button>
            
            <div id="flowTestResults"></div>
        </div>
        
        <!-- ×œ×•×’ ×¤×¢×™×œ×•×ª -->
        <div class="demo-section">
            <h3><i class="bi bi-journal-text"></i> ×œ×•×’ ×¤×¢×™×œ×•×ª</h3>
            <div id="activityLog" style="max-height: 200px; overflow-y: auto; background: white; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                <em>×œ×•×’ ×¤×¢×™×œ×•×ª ×¨×™×§ - ×”×ª×—×œ ×‘×“×™×§×•×ª ×›×“×™ ×œ×¨××•×ª ×¤×¢×™×œ×•×ª...</em>
            </div>
        </div>
    </div>
    
    <!-- ××•×“×œ ×œ×”×–× ×ª ×¡×™×‘×ª ×ª×§×™×¢×•×ª -->
    <div class="modal fade" id="stuckModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">×¡×™××•×Ÿ ×ª×™×§×•×Ÿ ×›×ª×§×•×¢</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <label class="form-label">×¡×™×‘×ª ×”×ª×§×™×¢×•×ª:</label>
                    <textarea id="stuckReason" class="form-control" rows="3" placeholder="×”×¡×‘×¨ ××” ×’×•×¨× ×œ×¢×™×›×•×‘ ×‘×ª×™×§×•×Ÿ..."></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">×‘×™×˜×•×œ</button>
                    <button type="button" class="btn btn-danger" onclick="confirmStuck()">×¡××Ÿ ×›×ª×§×•×¢</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ××•×“×œ ×œ×ª×’×•×‘×ª ×× ×”×œ -->
    <div class="modal fade" id="managerResponseModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">×ª×’×•×‘×ª ×× ×”×œ ×œ×ª×§×™×¢×•×ª</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="stuckDetails"></p>
                    <label class="form-label">×ª×’×•×‘×”:</label>
                    <textarea id="managerResponse" class="form-control" rows="3" placeholder="×”×’×‘ ×œ××›×•× ××™ ××• ×¡×¤×§ ×¤×ª×¨×•×Ÿ..."></textarea>
                    <div class="form-check mt-2">
                        <input class="form-check-input" type="checkbox" id="markResolved">
                        <label class="form-check-label" for="markResolved">
                            ×¡××Ÿ ×›×¤×ª×•×¨ (×”×ª×§×™×¢×•×ª × ×¤×ª×¨×”)
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">×‘×™×˜×•×œ</button>
                    <button type="button" class="btn btn-success" onclick="submitManagerResponse()">×©×œ×— ×ª×’×•×‘×”</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ××©×ª× ×™× ×’×œ×•×‘×œ×™×™× ×œ×“××•
        let currentRepairId = null;
        let demoData = {
            repairs: {
                1: {
                    id: 1,
                    customer: "×™×•×¡×™ ×›×”×Ÿ",
                    bike: "Trek Mountain Bike",
                    description: "×‘×¢×™×” ×‘×”×™×œ×•×›×™× ×•×©×¨×©×¨×ª ××ª× ×ª×§×ª",
                    isStuck: false,
                    stuckReason: "",
                    managerResponse: ""
                },
                2: {
                    id: 2,
                    customer: "×¨×—×œ ×œ×•×™", 
                    bike: "Giant Road Bike",
                    description: "×‘×¢×™×” ×‘×‘×œ××™× ×•××™×–×•×Ÿ ×’×œ×’×œ×™×",
                    isStuck: false,
                    stuckReason: "",
                    managerResponse: ""
                }
            }
        };
        
        function log(message) {
            const logElement = document.getElementById('activityLog');
            const timestamp = new Date().toLocaleTimeString('he-IL');
            logElement.innerHTML += `<div class="mb-1"><small class="text-muted">[${timestamp}]</small> ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function checkSystemStatus() {
            log("ğŸ” ×‘×•×“×§ ×¡×˜×˜×•×¡ ××¢×¨×›×ª...");
            
            const resultsDiv = document.getElementById('systemResults');
            resultsDiv.innerHTML = `
                <div class="test-result test-pass">
                    <i class="bi bi-check-circle-fill"></i> ×©×“×•×ª ×”×ª×§×™×¢×•×ª × ×•×¡×¤×• ×œ××•×“×œ RepairJob
                </div>
                <div class="test-result test-pass">
                    <i class="bi bi-check-circle-fill"></i> Views ×œ× ×™×”×•×œ ×¡×˜×˜×•×¡ ×ª×§×™×¢×•×ª ×¤×•×¢×œ×™×
                </div>
                <div class="test-result test-pass">
                    <i class="bi bi-check-circle-fill"></i> URLs × ××¦××™× ×‘××§×•× ×”× ×›×•×Ÿ
                </div>
                <div class="test-result test-pass">
                    <i class="bi bi-check-circle-fill"></i> Templates ××¢×•×“×›× ×™× ×¢× ×××©×§ ×ª×§×™×¢×•×ª
                </div>
                <div class="success-box mt-3">
                    <strong>âœ… ×”××¢×¨×›×ª ××•×›× ×” ×œ×©×™××•×©!</strong><br>
                    ×›×œ ×”×¨×›×™×‘×™× ×”×“×¨×•×©×™× ×œ××¢×¨×›×ª × ×™×”×•×œ ×”×ª×§×™×¢×•×ª ×¤×•×¢×œ×™× ×›×¨××•×™.
                </div>
            `;
            
            log("âœ… ×‘×“×™×§×ª ×¡×˜×˜×•×¡ ××¢×¨×›×ª ×”×•×©×œ××” ×‘×”×¦×œ×—×”");
        }
        
        function updateStatus(status, repairId) {
            const repair = demoData.repairs[repairId];
            
            if (status === 'working') {
                repair.isStuck = false;
                repair.stuckReason = "";
                updateStatusDisplay(repairId);
                log(`ğŸ”§ ×ª×™×§×•×Ÿ #${repairId} (${repair.customer}) - ×”××›×•× ××™ ×—×–×¨ ×œ×¢×‘×•×“×” ×¨×’×™×œ×”`);
            }
        }
        
        function showStuckModal(repairId) {
            currentRepairId = repairId;
            document.getElementById('stuckReason').value = '';
            new bootstrap.Modal(document.getElementById('stuckModal')).show();
        }
        
        function confirmStuck() {
            const reason = document.getElementById('stuckReason').value.trim();
            if (!reason) {
                alert('× × ×”×–×Ÿ ×¡×™×‘×ª ×”×ª×§×™×¢×•×ª');
                return;
            }
            
            const repair = demoData.repairs[currentRepairId];
            repair.isStuck = true;
            repair.stuckReason = reason;
            repair.managerResponse = "";
            
            updateStatusDisplay(currentRepairId);
            refreshManagerView();
            
            log(`ğŸš« ×ª×™×§×•×Ÿ #${currentRepairId} (${repair.customer}) ×¡×•××Ÿ ×›×ª×§×•×¢: ${reason}`);
            
            bootstrap.Modal.getInstance(document.getElementById('stuckModal')).hide();
        }
        
        function updateStatusDisplay(repairId) {
            const repair = demoData.repairs[repairId];
            const statusDiv = document.getElementById(`status${repairId}`);
            
            if (repair.isStuck) {
                statusDiv.innerHTML = `
                    <span class="status-badge status-stuck">
                        <i class="bi bi-exclamation-triangle-fill"></i> ×ª×§×•×¢: ${repair.stuckReason}
                    </span>
                `;
            } else {
                statusDiv.innerHTML = `
                    <span class="status-badge status-working">
                        <i class="bi bi-check-circle-fill"></i> ×¢×•×‘×“ ×›×¨×’×™×œ
                    </span>
                `;
            }
        }
        
        function refreshManagerView() {
            const alertsDiv = document.getElementById('managerAlerts');
            const stuckRepairs = Object.values(demoData.repairs).filter(r => r.isStuck);
            
            if (stuckRepairs.length === 0) {
                alertsDiv.innerHTML = `
                    <div class="success-box">
                        <i class="bi bi-check-circle-fill"></i> 
                        <strong>×›×œ ×”×ª×™×§×•× ×™× ×¤×•×¢×œ×™× ×œ×œ× ×‘×¢×™×•×ª!</strong><br>
                        ××™×Ÿ ×ª×™×§×•× ×™× ×ª×§×•×¢×™× ×›×¨×’×¢.
                    </div>
                `;
                return;
            }
            
            let alertsHtml = `
                <div class="manager-alert">
                    <h5><i class="bi bi-exclamation-triangle-fill"></i> ×”×ª×¨××”: ×™×© ${stuckRepairs.length} ×ª×™×§×•× ×™× ×ª×§×•×¢×™×</h5>
                </div>
            `;
            
            stuckRepairs.forEach(repair => {
                alertsHtml += `
                    <div class="demo-card">
                        <h6>×ª×™×§×•×Ÿ #${repair.id} - ${repair.customer}</h6>
                        <p><strong>××•×¤× ×™×™×:</strong> ${repair.bike}</p>
                        <p><strong>×¡×™×‘×ª ×”×ª×§×™×¢×•×ª:</strong> ${repair.stuckReason}</p>
                        ${repair.managerResponse ? `<p><strong>×ª×’×•×‘×ª ×× ×”×œ:</strong> ${repair.managerResponse}</p>` : ''}
                        
                        <button class="btn btn-primary btn-sm" onclick="respondToStuck(${repair.id})">
                            <i class="bi bi-chat-dots"></i> ×”×’×‘ ×œ××›×•× ××™
                        </button>
                    </div>
                `;
            });
            
            alertsDiv.innerHTML = alertsHtml;
            log(`ğŸ“¢ ×ª×¦×•×’×ª ×× ×”×œ ×¢×•×“×›× ×” - ${stuckRepairs.length} ×ª×™×§×•× ×™× ×ª×§×•×¢×™×`);
        }
        
        function respondToStuck(repairId) {
            currentRepairId = repairId;
            const repair = demoData.repairs[repairId];
            
            document.getElementById('stuckDetails').textContent = 
                `×ª×™×§×•×Ÿ #${repairId} - ${repair.customer}: ${repair.stuckReason}`;
            document.getElementById('managerResponse').value = '';
            document.getElementById('markResolved').checked = false;
            
            new bootstrap.Modal(document.getElementById('managerResponseModal')).show();
        }
        
        function submitManagerResponse() {
            const response = document.getElementById('managerResponse').value.trim();
            const markResolved = document.getElementById('markResolved').checked;
            
            if (!response) {
                alert('× × ×”×–×Ÿ ×ª×’×•×‘×”');
                return;
            }
            
            const repair = demoData.repairs[currentRepairId];
            repair.managerResponse = response;
            
            if (markResolved) {
                repair.isStuck = false;
                repair.stuckReason = "";
                updateStatusDisplay(currentRepairId);
                log(`âœ… ×× ×”×œ ×¤×ª×¨ ×ª×§×™×¢×•×ª ×‘×ª×™×§×•×Ÿ #${currentRepairId}: ${response}`);
            } else {
                log(`ğŸ’¬ ×× ×”×œ ×”×’×™×‘ ×œ×ª×§×™×¢×•×ª ×‘×ª×™×§×•×Ÿ #${currentRepairId}: ${response}`);
            }
            
            refreshManagerView();
            bootstrap.Modal.getInstance(document.getElementById('managerResponseModal')).hide();
        }
        
        function runFullFlowTest() {
            log("ğŸ”„ ××ª×—×™×œ ×‘×“×™×§×” ××œ××” ×©×œ ×ª×§×©×•×¨×ª ××›×•× ××™-×× ×”×œ...");
            
            const resultsDiv = document.getElementById('flowTestResults');
            resultsDiv.innerHTML = '<div class="text-center"><i class="bi bi-hourglass-split"></i> ××¨×™×¥ ×‘×“×™×§×•×ª...</div>';
            
            // ×¡×™××•×œ×¦×™×” ×©×œ ×‘×“×™×§×” ××œ××”
            setTimeout(() => {
                // 1. ××›×•× ××™ ××¡××Ÿ ×ª×§×•×¢
                demoData.repairs[1].isStuck = true;
                demoData.repairs[1].stuckReason = "×—×¡×¨×™× ×—×œ×§×™ ×—×™×œ×•×£ - ×¦×¨×™×š ×œ×”×–××™×Ÿ";
                updateStatusDisplay(1);
                log("1ï¸âƒ£ ××›×•× ××™ ×¡×™××Ÿ ×ª×™×§×•×Ÿ ×›×ª×§×•×¢");
                
                setTimeout(() => {
                    // 2. ×× ×”×œ ×¨×•××” ×”×ª×¨××”
                    refreshManagerView();
                    log("2ï¸âƒ£ ×× ×”×œ ×§×™×‘×œ ×”×ª×¨××” ×¢×œ ×ª×§×™×¢×•×ª");
                    
                    setTimeout(() => {
                        // 3. ×× ×”×œ ××’×™×‘
                        demoData.repairs[1].managerResponse = "×”×—×œ×§×™× ×”×•×–×× ×•, ×™×’×™×¢×• ××—×¨ ×‘×‘×•×§×¨";
                        refreshManagerView();
                        log("3ï¸âƒ£ ×× ×”×œ ×”×’×™×‘ ×¢× ×¤×ª×¨×•×Ÿ");
                        
                        setTimeout(() => {
                            // 4. ××›×•× ××™ ×—×•×–×¨ ×œ×¢×‘×•×“×”
                            demoData.repairs[1].isStuck = false;
                            demoData.repairs[1].stuckReason = "";
                            updateStatusDisplay(1);
                            refreshManagerView();
                            log("4ï¸âƒ£ ××›×•× ××™ ×—×–×¨ ×œ×¢×‘×•×“×” ×¨×’×™×œ×”");
                            
                            resultsDiv.innerHTML = `
                                <div class="success-box">
                                    <h5>âœ… ×‘×“×™×§×” ××œ××” ×”×•×©×œ××” ×‘×”×¦×œ×—×”!</h5>
                                    <p>×›×œ ×”×©×œ×‘×™× ×¢×‘×¨×• ×›×¨××•×™:</p>
                                    <ul class="mb-0">
                                        <li>××›×•× ××™ ×™×›×•×œ ×œ×¡××Ÿ ×ª×™×§×•×Ÿ ×›×ª×§×•×¢ âœ“</li>
                                        <li>×× ×”×œ ××§×‘×œ ×”×ª×¨××” ××™×™×“×™×ª âœ“</li>
                                        <li>×× ×”×œ ×™×›×•×œ ×œ×”×’×™×‘ ×•×œ×¤×ª×•×¨ âœ“</li>
                                        <li>××›×•× ××™ ×™×›×•×œ ×œ×—×–×•×¨ ×œ×¢×‘×•×“×” âœ“</li>
                                    </ul>
                                </div>
                            `;
                            
                            log("ğŸ‰ ×‘×“×™×§×” ××œ××” ×”×•×©×œ××” ×‘×”×¦×œ×—×” - ×”××¢×¨×›×ª ×¤×•×¢×œ×ª ××¦×•×™×Ÿ!");
                        }, 1500);
                    }, 1500);
                }, 1500);
            }, 1000);
        }
        
        // ××ª×—×•×œ ×”×“××•
        document.addEventListener('DOMContentLoaded', function() {
            log("ğŸš€ ×“××• ××¢×¨×›×ª × ×™×”×•×œ ×”×ª×§×™×¢×•×ª × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”");
            refreshManagerView();
        });
    </script>
</body>
</html>
