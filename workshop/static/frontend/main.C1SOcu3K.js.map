{"version":3,"file":"main.C1SOcu3K.js","sources":["../../../frontend/src/hooks/useWebSocket.js"],"sourcesContent":["import { useEffect, useRef, useState } from 'react'\r\n\r\nexport function useWebSocket(url, userType = 'customer') {\r\n  const [isConnected, setIsConnected] = useState(false)\r\n  const [messages, setMessages] = useState([])\r\n  const socketRef = useRef(null)\r\n  const heartbeatRef = useRef(null)\r\n\r\n  const connect = () => {\r\n    if (socketRef.current?.readyState === WebSocket.OPEN) {\r\n      return\r\n    }\r\n\r\n    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:'\r\n    const wsUrl = `${protocol}//${window.location.host}/ws/workshop/${userType}/`\r\n    \r\n    socketRef.current = new WebSocket(wsUrl)\r\n\r\n    socketRef.current.onopen = () => {\r\n      console.log('ðŸ”Œ WebSocket connected')\r\n      setIsConnected(true)\r\n      startHeartbeat()\r\n    }\r\n\r\n    socketRef.current.onmessage = (event) => {\r\n      try {\r\n        const data = JSON.parse(event.data)\r\n        console.log('ðŸ“¨ WebSocket message:', data)\r\n        setMessages(prev => [...prev, data])\r\n      } catch (error) {\r\n        console.error('Error parsing WebSocket message:', error)\r\n      }\r\n    }\r\n\r\n    socketRef.current.onclose = (event) => {\r\n      console.log('âŒ WebSocket disconnected:', event.code)\r\n      setIsConnected(false)\r\n      stopHeartbeat()\r\n      \r\n      // Auto-reconnect after 3 seconds\r\n      setTimeout(() => {\r\n        console.log('ðŸ”„ Attempting to reconnect...')\r\n        connect()\r\n      }, 3000)\r\n    }\r\n\r\n    socketRef.current.onerror = (error) => {\r\n      console.error('WebSocket error:', error)\r\n      setIsConnected(false)\r\n    }\r\n  }\r\n\r\n  const startHeartbeat = () => {\r\n    heartbeatRef.current = setInterval(() => {\r\n      if (socketRef.current?.readyState === WebSocket.OPEN) {\r\n        socketRef.current.send(JSON.stringify({\r\n          type: 'ping',\r\n          timestamp: Date.now()\r\n        }))\r\n      }\r\n    }, 30000)\r\n  }\r\n\r\n  const stopHeartbeat = () => {\r\n    if (heartbeatRef.current) {\r\n      clearInterval(heartbeatRef.current)\r\n      heartbeatRef.current = null\r\n    }\r\n  }\r\n\r\n  const sendMessage = (message) => {\r\n    if (socketRef.current?.readyState === WebSocket.OPEN) {\r\n      socketRef.current.send(JSON.stringify(message))\r\n    } else {\r\n      console.warn('WebSocket not connected, cannot send message')\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    connect()\r\n    \r\n    return () => {\r\n      stopHeartbeat()\r\n      if (socketRef.current) {\r\n        socketRef.current.close()\r\n      }\r\n    }\r\n  }, [url, userType])\r\n\r\n  return {\r\n    isConnected,\r\n    messages,\r\n    sendMessage,\r\n    connect\r\n  }\r\n}"],"names":["useWebSocket","url","userType","isConnected","setIsConnected","useState","messages","setMessages","socketRef","useRef","heartbeatRef","connect","wsUrl","startHeartbeat","event","data","prev","error","stopHeartbeat","sendMessage","message","useEffect"],"mappings":"yCAEO,SAASA,EAAaC,EAAKC,EAAW,WAAY,CACvD,KAAM,CAACC,EAAaC,CAAc,EAAIC,EAAAA,SAAS,EAAK,EAC9C,CAACC,EAAUC,CAAW,EAAIF,EAAAA,SAAS,CAAA,CAAE,EACrCG,EAAYC,EAAAA,OAAO,IAAI,EACvBC,EAAeD,EAAAA,OAAO,IAAI,EAE1BE,EAAU,IAAM,CACpB,GAAIH,EAAU,SAAS,aAAe,UAAU,KAC9C,OAIF,MAAMI,EAAQ,GADG,OAAO,SAAS,WAAa,SAAW,OAAS,KACzC,KAAK,OAAO,SAAS,IAAI,gBAAgBV,CAAQ,IAE1EM,EAAU,QAAU,IAAI,UAAUI,CAAK,EAEvCJ,EAAU,QAAQ,OAAS,IAAM,CAC/B,QAAQ,IAAI,wBAAwB,EACpCJ,EAAe,EAAI,EACnBS,EAAc,CAChB,EAEAL,EAAU,QAAQ,UAAaM,GAAU,CACvC,GAAI,CACF,MAAMC,EAAO,KAAK,MAAMD,EAAM,IAAI,EAClC,QAAQ,IAAI,wBAAyBC,CAAI,EACzCR,EAAYS,GAAQ,CAAC,GAAGA,EAAMD,CAAI,CAAC,CACrC,OAASE,EAAO,CACd,QAAQ,MAAM,mCAAoCA,CAAK,CACzD,CACF,EAEAT,EAAU,QAAQ,QAAWM,GAAU,CACrC,QAAQ,IAAI,4BAA6BA,EAAM,IAAI,EACnDV,EAAe,EAAK,EACpBc,EAAa,EAGb,WAAW,IAAM,CACf,QAAQ,IAAI,+BAA+B,EAC3CP,EAAO,CACT,EAAG,GAAI,CACT,EAEAH,EAAU,QAAQ,QAAWS,GAAU,CACrC,QAAQ,MAAM,mBAAoBA,CAAK,EACvCb,EAAe,EAAK,CACtB,CACF,EAEMS,EAAiB,IAAM,CAC3BH,EAAa,QAAU,YAAY,IAAM,CACnCF,EAAU,SAAS,aAAe,UAAU,MAC9CA,EAAU,QAAQ,KAAK,KAAK,UAAU,CACpC,KAAM,OACN,UAAW,KAAK,IAAG,CAC7B,CAAS,CAAC,CAEN,EAAG,GAAK,CACV,EAEMU,EAAgB,IAAM,CACtBR,EAAa,UACf,cAAcA,EAAa,OAAO,EAClCA,EAAa,QAAU,KAE3B,EAEMS,EAAeC,GAAY,CAC3BZ,EAAU,SAAS,aAAe,UAAU,KAC9CA,EAAU,QAAQ,KAAK,KAAK,UAAUY,CAAO,CAAC,EAE9C,QAAQ,KAAK,8CAA8C,CAE/D,EAEAC,OAAAA,EAAAA,UAAU,KACRV,EAAO,EAEA,IAAM,CACXO,EAAa,EACTV,EAAU,SACZA,EAAU,QAAQ,MAAK,CAE3B,GACC,CAACP,EAAKC,CAAQ,CAAC,EAEX,CACL,YAAAC,EACA,SAAAG,EACA,YAAAa,EACA,QAAAR,CACJ,CACA"}