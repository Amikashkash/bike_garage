import{c as m,j as e,r as n}from"./client.CZIp3qzo.js";import"./react-vendor.CiW5Bwbg.js";const u=()=>{const[t,r]=n.useState({stuck_repairs:[],pending_diagnosis:[],pending_approval:[],approved_waiting_for_mechanic:[],in_progress:[],awaiting_quality_check:[],repairs_not_collected:[]}),[a,s]=n.useState(!0),[o,d]=n.useState(null);n.useEffect(()=>{c();const l=setInterval(c,3e4);return()=>clearInterval(l)},[]);const c=async()=>{try{const l=await fetch("/api/manager/dashboard/",{credentials:"same-origin",headers:{"X-CSRFToken":document.querySelector("[name=csrfmiddlewaretoken]")?.value||""}});if(!l.ok)throw new Error("Failed to fetch dashboard data");const b=await l.json();r(b),s(!1)}catch(l){d(l.message),s(!1)}};return a?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-400 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-slate-300 text-lg",children:"טוען נתוני דשבורד..."})]})}):o?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center",children:e.jsx("div",{className:"bg-red-900/20 border border-red-500/30 rounded-2xl p-8 max-w-md mx-auto",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"fas fa-exclamation-triangle text-red-400 text-4xl mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"שגיאה בטעינת הנתונים"}),e.jsx("p",{className:"text-red-200 mb-4",children:o}),e.jsx("button",{onClick:c,className:"bg-red-500/20 hover:bg-red-500/30 text-red-300 px-4 py-2 rounded-lg border border-red-400/40 transition-all duration-200",children:"נסה שוב"})]})})}):e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(g,{}),e.jsx(h,{data:t}),e.jsx(v,{data:t}),e.jsx(y,{}),e.jsx(N,{})]})},g=()=>e.jsx("div",{className:"text-center mb-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"mb-4 md:mb-0",children:[e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-blue-500 via-purple-500 to-cyan-500 bg-clip-text text-transparent mb-2",children:"🎯 דשבורד מנהל"}),e.jsx("p",{className:"text-slate-300",children:"ניהול תיקונים וזרימת עבודה - מבט כולל על כל הפעילות"})]}),e.jsxs("div",{className:"flex gap-3 justify-center md:justify-end flex-wrap",children:[e.jsx(i,{href:"/repair/new/",icon:"fas fa-plus",text:"תיקון חדש",gradient:"from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700",title:"צור תיקון חדש"}),e.jsx(i,{href:"/backup/menu/",icon:"fas fa-download",text:"גיבוי",gradient:"from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600",title:"גיבוי נתונים"}),e.jsx(i,{href:"/print-labels/",icon:"fas fa-print",text:"מדבקות",gradient:"from-slate-600 to-slate-700 hover:from-slate-700 hover:to-slate-800",title:"הדפסת מדבקות"})]})]})}),i=({href:t,icon:r,text:a,gradient:s,title:o})=>e.jsxs("a",{href:t,className:`bg-gradient-to-r ${s} text-white font-semibold px-4 py-2 rounded-lg transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 inline-flex items-center gap-2`,title:o,children:[e.jsx("i",{className:r}),a]}),h=({data:t})=>{const r=[{key:"stuck_repairs",title:"תיקונים תקועים - דרושה עזרה מיידית",subtitle:"פעולה דרושה עכשיו",icon:"fas fa-exclamation-triangle",color:"red",bgColor:"bg-red-900/20",borderColor:"border-red-500/30",headerBg:"bg-red-500/20",headerBorder:"border-red-500/30",iconBg:"bg-red-500/30",iconColor:"text-red-400",buttonBg:"bg-red-500/30",buttonText:"text-red-200",buttonBorder:"border-red-500/40",buttonHover:"hover:bg-red-500/40",animate:"animate-pulse",priority:!0,countSuffix:"מכונאי מחכה"},{key:"pending_diagnosis",title:"ממתינים לאבחון",subtitle:"תיקונים שדורשים אבחון ראשוני",icon:"fas fa-search",color:"orange",bgColor:"bg-slate-800/50",borderColor:"border-slate-700",headerBg:"bg-orange-500/20",headerBorder:"border-orange-500/30",iconBg:"bg-orange-500/20",iconColor:"text-orange-400",buttonBg:"bg-orange-500/30",buttonText:"text-orange-200",buttonBorder:"border-orange-500/40",buttonHover:"hover:bg-orange-500/40",countSuffix:"ממתינים"},{key:"pending_approval",title:"ממתינים לאישור הלקוח",subtitle:"הצעות מחיר שממתינות לאישור",icon:"fas fa-clipboard-check",color:"blue",bgColor:"bg-slate-800/50",borderColor:"border-slate-700",headerBg:"bg-blue-500/20",headerBorder:"border-blue-500/30",iconBg:"bg-blue-500/30",iconColor:"text-blue-400",buttonBg:"bg-blue-500/30",buttonText:"text-blue-200",buttonBorder:"border-blue-500/40",buttonHover:"hover:bg-blue-500/40",countSuffix:"ממתינים"},{key:"approved_waiting_for_mechanic",title:"מאושרים - ממתינים להקצאת מכונאי",subtitle:"תיקונים מאושרים שצריכים הקצאת מכונאי",icon:"fas fa-user-plus",color:"purple",bgColor:"bg-slate-800/50",borderColor:"border-slate-700",headerBg:"bg-purple-500/20",headerBorder:"border-purple-500/30",iconBg:"bg-purple-500/30",iconColor:"text-purple-400",buttonBg:"bg-purple-500/30",buttonText:"text-purple-200",buttonBorder:"border-purple-500/40",buttonHover:"hover:bg-purple-500/40",countSuffix:"ממתינים"},{key:"in_progress",title:"בעבודה",subtitle:"תיקונים פעילים כרגע",icon:"fas fa-cogs",color:"green",bgColor:"bg-slate-800/50",borderColor:"border-slate-700",headerBg:"bg-green-500/20",headerBorder:"border-green-500/30",iconBg:"bg-green-500/30",iconColor:"text-green-400",buttonBg:"bg-green-500/30",buttonText:"text-green-200",buttonBorder:"border-green-500/40",buttonHover:"hover:bg-green-500/40",countSuffix:"פעילים"},{key:"awaiting_quality_check",title:"ממתינים לבדיקת איכות",subtitle:"תיקונים שהושלמו וממתינים לאישור איכות",icon:"fas fa-search-plus",color:"yellow",bgColor:"bg-slate-800/50",borderColor:"border-slate-700",headerBg:"bg-yellow-500/20",headerBorder:"border-yellow-500/30",iconBg:"bg-yellow-500/30",iconColor:"text-yellow-400",buttonBg:"bg-yellow-500/30",buttonText:"text-yellow-200",buttonBorder:"border-yellow-500/40",buttonHover:"hover:bg-yellow-500/40",countSuffix:"לבדיקה"},{key:"repairs_not_collected",title:"מוכנים לאיסוף",subtitle:"אופניים שהושלמו וממתינים לאיסוף",icon:"fas fa-check-circle",color:"cyan",bgColor:"bg-slate-800/50",borderColor:"border-slate-700",headerBg:"bg-cyan-500/20",headerBorder:"border-cyan-500/30",iconBg:"bg-cyan-500/30",iconColor:"text-cyan-400",buttonBg:"bg-cyan-500/30",buttonText:"text-cyan-200",buttonBorder:"border-cyan-500/40",buttonHover:"hover:bg-cyan-500/40",countSuffix:"מוכנים"}];return e.jsx("div",{className:"space-y-6",children:r.map(a=>{const s=t[a.key]||[];return s.length===0?null:e.jsx(f,{section:a,repairs:s},a.key)})})},f=({section:t,repairs:r})=>{const[a,s]=n.useState(!1),o=()=>{s(!a)};return e.jsxs("div",{className:`${t.bgColor} backdrop-blur-sm border ${t.borderColor} rounded-2xl overflow-hidden ${t.animate||""}`,children:[e.jsx("div",{className:`${t.headerBg} px-6 py-4 border-b ${t.headerBorder}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 ${t.iconBg} rounded-xl flex items-center justify-center`,children:e.jsx("i",{className:`${t.icon} ${t.iconColor} text-xl ${t.animate||""}`})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:t.title}),e.jsx("p",{className:`${t.buttonText} text-sm`,children:t.subtitle})]})]}),e.jsxs("button",{className:`flex items-center justify-between w-48 md:w-56 px-4 py-3 ${t.buttonBg} ${t.buttonText} rounded-lg border ${t.buttonBorder} ${t.buttonHover} transition-all duration-300 cursor-pointer ${t.animate||""}`,onClick:o,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:t.icon}),e.jsxs("span",{className:"text-sm md:text-base",children:[r.length," ",t.countSuffix]})]}),e.jsx("i",{className:`fas fa-chevron-down transition-transform duration-300 text-sm ${a?"rotate-180":""}`})]})]})}),e.jsx("div",{className:`transition-all duration-500 ease-in-out overflow-hidden ${a?"max-h-screen opacity-100":"max-h-0 opacity-0"}`,children:e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:r.map(d=>e.jsx(j,{repair:d,section:t},d.id))})})})]})},p=t=>{if(!confirm("האם לסמן את האופניים כנאספו על ידי הלקוח?"))return;const r=document.querySelector(`button[onclick*="markAsPickedUp(${t})"]`);r&&(r.disabled=!0,r.innerHTML='<i class="fas fa-spinner fa-spin"></i>'),fetch(`/manager/mark-delivered/${t}/`,{method:"POST",headers:{"X-CSRFToken":document.querySelector("[name=csrfmiddlewaretoken]")?.value||"","Content-Type":"application/json"}}).then(a=>a.json()).then(a=>{if(a.success){const s=r.closest(".bg-slate-800\\/60");s&&(s.style.transition="all 0.5s ease-out",s.style.opacity="0",s.style.transform="scale(0.9)",setTimeout(()=>{s.remove()},500)),alert("האופניים סומנו כנאספו בהצלחה!")}else alert("שגיאה בעדכון הסטטוס: "+(a.error||"שגיאה לא ידועה")),r&&(r.disabled=!1,r.innerHTML='<i class="fas fa-check"></i>')}).catch(a=>{console.error("Error:",a),alert("שגיאה בעדכון הסטטוס. נסה שוב."),r&&(r.disabled=!1,r.innerHTML='<i class="fas fa-check"></i>')})},j=({repair:t,section:r})=>{const a=()=>{switch(r.key){case"stuck_repairs":return e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("a",{href:`/repair/status/${t.id}/`,className:"flex items-center gap-2 px-4 py-2 bg-slate-700/50 hover:bg-slate-600/50 text-slate-300 hover:text-white rounded-lg border border-slate-600 hover:border-slate-500 transition-all duration-200",children:[e.jsx("i",{className:"fas fa-eye"}),e.jsx("span",{className:"text-sm",children:"צפה"})]}),e.jsxs("a",{href:`/manager/repair/${t.id}/`,className:`flex items-center gap-2 px-4 py-2 bg-${r.color}-500/20 hover:bg-${r.color}-500/30 text-${r.color}-300 hover:text-${r.color}-200 rounded-lg border border-${r.color}-400/40 hover:border-${r.color}-400/60 transition-all duration-200`,children:[e.jsx("i",{className:"fas fa-reply"}),e.jsx("span",{className:"text-sm",children:"הגב"})]})]});case"pending_diagnosis":return e.jsxs("a",{href:`/manager/repair/${t.id}/diagnosis/`,className:`flex items-center gap-2 px-6 py-2 bg-${r.color}-500/20 hover:bg-${r.color}-500/30 text-${r.color}-300 hover:text-${r.color}-200 rounded-lg border border-${r.color}-400/40 hover:border-${r.color}-400/60 transition-all duration-200 w-full justify-center`,children:[e.jsx("i",{className:"fas fa-stethoscope"}),e.jsx("span",{className:"text-sm font-medium",children:"אבחן עכשיו"})]});case"pending_approval":return e.jsxs("a",{href:`/repair/${t.id}/approve/`,className:`flex items-center gap-2 px-6 py-2 bg-${r.color}-500/20 hover:bg-${r.color}-500/30 text-${r.color}-300 hover:text-${r.color}-200 rounded-lg border border-${r.color}-400/40 hover:border-${r.color}-400/60 transition-all duration-200 w-full justify-center`,children:[e.jsx("i",{className:"fas fa-check"}),e.jsx("span",{className:"text-sm font-medium",children:"נהל אישור"})]});case"approved_waiting_for_mechanic":return e.jsxs("a",{href:`/manager/repair/${t.id}/assign/`,className:`flex items-center gap-2 px-6 py-2 bg-${r.color}-500/20 hover:bg-${r.color}-500/30 text-${r.color}-300 hover:text-${r.color}-200 rounded-lg border border-${r.color}-400/40 hover:border-${r.color}-400/60 transition-all duration-200 w-full justify-center`,children:[e.jsx("i",{className:"fas fa-user-plus"}),e.jsx("span",{className:"text-sm font-medium",children:"הקצה מכונאי"})]});case"in_progress":return e.jsxs("a",{href:`/repair/status/${t.id}/`,className:`flex items-center gap-2 px-6 py-2 bg-${r.color}-500/20 hover:bg-${r.color}-500/30 text-${r.color}-300 hover:text-${r.color}-200 rounded-lg border border-${r.color}-400/40 hover:border-${r.color}-400/60 transition-all duration-200 w-full justify-center`,children:[e.jsx("i",{className:"fas fa-eye"}),e.jsx("span",{className:"text-sm font-medium",children:"צפה בפרטים"})]});case"awaiting_quality_check":return e.jsxs("a",{href:`/manager/quality-check/${t.id}/`,className:`flex items-center gap-2 px-6 py-2 bg-${r.color}-500/20 hover:bg-${r.color}-500/30 text-${r.color}-300 hover:text-${r.color}-200 rounded-lg border border-${r.color}-400/40 hover:border-${r.color}-400/60 transition-all duration-200 w-full justify-center`,children:[e.jsx("i",{className:"fas fa-check-double"}),e.jsx("span",{className:"text-sm font-medium",children:"בדוק איכות"})]});case"repairs_not_collected":return e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("a",{href:`/repair/status/${t.id}/`,className:"flex items-center gap-1 px-3 py-2 bg-slate-700/50 hover:bg-slate-600/50 text-slate-300 hover:text-white rounded-lg border border-slate-600 hover:border-slate-500 transition-all duration-200 text-xs",children:[e.jsx("i",{className:"fas fa-eye"}),e.jsx("span",{children:"צפה"})]}),e.jsxs("a",{href:`tel:${t.bike?.customer?.phone||""}`,className:`flex items-center gap-1 px-3 py-2 bg-${r.color}-500/20 hover:bg-${r.color}-500/30 text-${r.color}-300 hover:text-${r.color}-200 rounded-lg border border-${r.color}-400/40 hover:border-${r.color}-400/60 transition-all duration-200 text-xs`,children:[e.jsx("i",{className:"fas fa-phone"}),e.jsx("span",{children:"התקשר"})]}),e.jsxs("button",{onClick:()=>p(t.id),className:"flex items-center gap-1 px-3 py-2 bg-green-500/20 hover:bg-green-500/30 text-green-300 hover:text-green-200 rounded-lg border border-green-400/40 hover:border-green-400/60 transition-all duration-200 text-xs",children:[e.jsx("i",{className:"fas fa-check"}),e.jsx("span",{children:"נאסף"})]})]});default:return null}},o=(()=>{switch(r.key){case"stuck_repairs":return{text:"דרושה עזרה",color:"bg-red-500/30 border-red-400/40 text-red-200",animate:"animate-pulse"};case"pending_approval":return{text:`₪${t.get_total_price||"0"}`,color:"bg-green-500/30 border-green-400/40 text-green-200"};case"approved_waiting_for_mechanic":return{text:`₪${t.get_total_approved_price||"0"}`,color:"bg-green-500/30 border-green-400/40 text-green-200"};case"in_progress":return{text:`${t.progress_percentage||0}%`,color:"bg-green-500/30 border-green-400/40 text-green-200"};case"awaiting_quality_check":return{text:"בדיקת איכות",color:`bg-${r.color}-500/30 border-${r.color}-400/40 text-${r.color}-200`};case"repairs_not_collected":return{text:"מוכן לאיסוף",color:`bg-${r.color}-500/30 border-${r.color}-400/40 text-${r.color}-200`};default:return null}})();return e.jsxs("div",{className:`bg-slate-800/60 backdrop-blur-sm border border-${r.color}-400/40 rounded-xl overflow-hidden hover:border-${r.color}-400/60 transition-all duration-300 hover:shadow-lg hover:shadow-${r.color}-500/20`,children:[e.jsx("div",{className:`bg-${r.color}-500/10 border-b border-${r.color}-400/30 p-4`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 bg-${r.color}-500/20 rounded-lg flex items-center justify-center`,children:e.jsx("i",{className:`${r.icon} ${r.iconColor} ${r.key==="in_progress"?"animate-spin":""} ${r.key==="stuck_repairs"?"animate-pulse":""}`})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-white",children:["#",t.id]}),e.jsxs("p",{className:`${r.buttonText} text-sm`,children:[t.bike?.brand," ",t.bike?.model]})]})]}),o&&e.jsx("div",{className:`px-3 py-1 rounded-full border ${o.color} ${o.animate||""}`,children:e.jsx("span",{className:"text-xs font-bold",children:o.text})})]})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx("i",{className:"fas fa-user text-slate-400 w-4"}),e.jsx("span",{className:"text-white",children:t.bike?.customer?.name||"ללא שם"})]}),t.assigned_mechanic&&e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx("i",{className:"fas fa-wrench text-slate-400 w-4"}),e.jsx("span",{className:"text-white",children:t.assigned_mechanic.get_full_name||t.assigned_mechanic.username})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx("i",{className:`fas fa-clock ${r.iconColor} w-4`}),e.jsx("span",{className:r.buttonText,children:r.key==="stuck_repairs"?`תקוע ${t.created_at_display||""}`:r.key==="pending_diagnosis"?"ממתין לאבחון":r.key==="pending_approval"?"ממתין לאישור הלקוח":r.key==="approved_waiting_for_mechanic"?"ממתין להקצאת מכונאי":r.key==="in_progress"?"בעבודה כרגע":r.key==="awaiting_quality_check"?"ממתין לבדיקת איכות":r.key==="repairs_not_collected"?`הושלם ${t.completed_at_display||""}`:"סטטוס לא ידוע"})]}),r.key==="stuck_repairs"&&t.stuck_reason&&e.jsx("div",{className:"bg-red-500/10 border border-red-400/30 rounded-lg p-3 mt-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("i",{className:"fas fa-exclamation-circle text-red-400 mt-0.5"}),e.jsx("span",{className:"text-red-200 text-sm",children:t.stuck_reason})]})}),r.key==="repairs_not_collected"&&e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx("i",{className:"fas fa-shekel-sign text-green-400 w-4"}),e.jsxs("span",{className:"text-green-300",children:["₪",t.get_total_approved_price||"0"]})]})]}),e.jsx("div",{className:`border-t border-${r.color}-400/30 bg-${r.color}-500/5 p-4`,children:e.jsx("div",{className:"flex items-center justify-center",children:a()})})]})},v=({data:t})=>Object.values(t).some(a=>a&&a.length>0)?null:e.jsx("div",{className:"text-center py-20",children:e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-2xl p-12 max-w-2xl mx-auto",children:[e.jsx("div",{className:"w-24 h-24 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx("i",{className:"fas fa-clipboard-check text-green-400 text-4xl"})}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"כל התיקונים במצב תקין"}),e.jsx("p",{className:"text-slate-400 mb-8",children:"אין תיקונים הדורשים טיפול מיוחד כרגע"}),e.jsxs("a",{href:"/",className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold px-8 py-4 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 inline-flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-home"}),"חזרה לדף הבית"]})]})}),y=()=>e.jsx("div",{className:"text-center mt-8",children:e.jsxs("a",{href:"/",className:"bg-gradient-to-r from-slate-600 to-slate-700 hover:from-slate-700 hover:to-slate-800 text-white font-semibold px-6 py-3 rounded-lg transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 inline-flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-home"}),"חזרה לדף הבית"]})}),N=()=>e.jsx("div",{className:"fixed bottom-6 left-6 z-40",children:e.jsxs("a",{href:"/repair/new/",className:"group flex items-center gap-3 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white px-4 py-3 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 border border-blue-400/20",title:"צור תיקון חדש",children:[e.jsx("i",{className:"fas fa-plus text-lg"}),e.jsx("span",{className:"hidden group-hover:inline-block transition-all duration-300 text-sm font-medium",children:"תיקון חדש"})]})}),x=document.getElementById("root");x&&m.createRoot(x).render(e.jsx(u,{}));
//# sourceMappingURL=manager-dashboard.js.map
