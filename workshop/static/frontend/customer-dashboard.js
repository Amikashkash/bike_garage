import{r as a,j as e,c as C}from"./client.CZIp3qzo.js";import{u as E}from"./main.Bn48PirJ.js";import"./react-vendor.CiW5Bwbg.js";function R(){const[t,i]=a.useState(!0),[c,n]=a.useState(null),[o,L]=a.useState(null),[d,u]=a.useState({active_repairs:0,total_repairs:0,notifications:0,ready_for_pickup:0}),[x,f]=a.useState([]),[p,b]=a.useState([]),[g,S]=a.useState(!1),{isConnected:j,messages:N}=E(null,"customer");a.useEffect(()=>{Promise.all([fetch("/api/customer/stats/",{credentials:"include"}).then(s=>s.json()),fetch("/api/customer/repairs/",{credentials:"include"}).then(s=>s.json()),fetch("/api/customer/notifications/",{credentials:"include"}).then(s=>s.json())]).then(([s,r,l])=>{u(s),f(r.results||r),b(l.results||l),i(!1)}).catch(s=>{console.error("Error fetching data:",s),n("שגיאה בטעינת הנתונים"),i(!1)})},[]),a.useEffect(()=>{N.forEach(s=>{(s.type==="repair_status_update"||s.type==="notification")&&Promise.all([fetch("/api/customer/stats/",{credentials:"include"}).then(r=>r.json()),fetch("/api/customer/repairs/",{credentials:"include"}).then(r=>r.json()),fetch("/api/customer/notifications/",{credentials:"include"}).then(r=>r.json())]).then(([r,l,w])=>{u(r),f(l.results||l),b(w.results||w)}).catch(r=>console.error("Error refreshing data:",r))})},[N]);const $=async s=>{try{await fetch(`/api/customer/notifications/${s}/read/`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":document.querySelector("[name=csrfmiddlewaretoken]")?.value||""}}),b(r=>r.map(l=>l.id===s?{...l,is_read:!0}:l)),u(r=>({...r,notifications:r.notifications-1}))}catch(r){console.error("Error marking notification as read:",r)}},v=s=>({completed:"bg-green-500/20 text-green-300 border-green-500/30",delivered:"bg-green-600/20 text-green-200 border-green-600/30",quality_approved:"bg-emerald-500/20 text-emerald-300 border-emerald-500/30",in_progress:"bg-blue-500/20 text-blue-300 border-blue-500/30",approved:"bg-cyan-500/20 text-cyan-300 border-cyan-500/30",diagnosed:"bg-yellow-500/20 text-yellow-300 border-yellow-500/30",partially_approved:"bg-amber-500/20 text-amber-300 border-amber-500/30",reported:"bg-orange-500/20 text-orange-300 border-orange-500/30",awaiting_quality_check:"bg-purple-500/20 text-purple-300 border-purple-500/30"})[s]||"bg-gray-500/20 text-gray-300 border-gray-500/30",y=s=>s.status==="diagnosed"||s.status==="partially_approved"?e.jsxs("a",{href:`/repair/${s.id}/approve/`,className:"block mt-2 bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs transition-colors duration-200 text-center",children:[e.jsx("i",{className:"fas fa-check ml-1"}),"אשר"]}):e.jsxs("a",{href:`/repair/${s.id}/status/`,className:"block mt-2 bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs transition-colors duration-200 text-center",children:[e.jsx("i",{className:"fas fa-eye ml-1"}),"צפה"]});return t?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"טוען..."})]})}):c?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"fas fa-exclamation-triangle text-red-400 text-4xl mb-4"}),e.jsx("p",{className:"text-red-300",children:c}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors",children:"נסה שוב"})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:[e.jsx("div",{className:"bg-slate-800/30 backdrop-blur-md border-b border-slate-700",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500/20 rounded-xl flex items-center justify-center",children:e.jsx("i",{className:"fas fa-bicycle text-blue-400"})}),e.jsx("h1",{className:"text-xl font-bold text-white",children:"לוח הבקרה האישי"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>S(!g),className:"relative p-2 bg-slate-700/50 rounded-lg hover:bg-slate-700 transition-colors",children:[e.jsx("i",{className:"fas fa-bell text-slate-300"}),d.notifications>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center",children:d.notifications})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${j?"bg-green-400":"bg-red-400"}`}),e.jsx("span",{className:"text-sm text-slate-400",children:j?"מחובר":"מנותק"})]})]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:"שלום! 👋"}),e.jsx("p",{className:"text-blue-200 text-lg",children:"ברוך הבא לדשבורד האישי שלך"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx(m,{icon:"fas fa-tools",title:"תיקונים פעילים",value:d.active_repairs,color:"blue"}),e.jsx(m,{icon:"fas fa-history",title:"סה״כ תיקונים",value:d.total_repairs,color:"purple"}),e.jsx(m,{icon:"fas fa-bell",title:"התראות חדשות",value:d.notifications,color:"red"}),e.jsx(m,{icon:"fas fa-check-circle",title:"מוכן לאיסוף",value:d.ready_for_pickup,color:"green"})]}),g&&e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6 mb-8",children:[e.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-bell text-blue-400"}),"התראות אחרונות"]}),p.length>0?e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:p.slice(0,10).map(s=>e.jsx("div",{className:`p-3 rounded-lg border ${s.is_read?"bg-slate-700/30 border-slate-600":"bg-blue-500/10 border-blue-500/30"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-white font-medium",children:s.title}),e.jsx("p",{className:"text-slate-300 text-sm mt-1",children:s.message}),e.jsxs("div",{className:"flex items-center text-xs text-slate-400 mt-2",children:[e.jsx("i",{className:"fas fa-clock ml-1"}),new Date(s.created_at).toLocaleDateString("he-IL")]})]}),!s.is_read&&e.jsx("button",{onClick:()=>$(s.id),className:"text-blue-400 hover:text-blue-300 text-sm",children:"סמן כנקרא"})]})},s.id))}):e.jsx("p",{className:"text-slate-400",children:"אין התראות חדשות"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(h,{icon:"fas fa-plus-circle",title:"דיווח תיקון חדש",description:"דווח על תקלה באופניים שלך",href:"/customer/report/",color:"bg-gradient-to-br from-red-500 to-red-600"}),e.jsx(h,{icon:"fas fa-bicycle",title:"רשימת אופניים",description:"צפה וערוך את רשימת האופניים שלך",href:"/my-bikes/",color:"bg-gradient-to-br from-blue-500 to-blue-600"}),e.jsx(h,{icon:"fas fa-plus",title:"הוסף אופניים",description:"הוסף אופניים חדשים למערכת",href:"/my-bikes/add/",color:"bg-gradient-to-br from-green-500 to-green-600"})]}),x.filter(s=>!["completed","delivered"].includes(s.status)).length>0&&e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6 mb-8",children:[e.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-tools text-blue-400"}),"תיקונים פעילים"]}),e.jsx("div",{className:"space-y-4",children:x.filter(s=>!["completed","delivered"].includes(s.status)).map(s=>e.jsx(_,{repair:s,getStatusColor:v,getActionButton:y},s.id))})]}),e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-history text-purple-400"}),"היסטוריית תיקונים"]}),x.length>0?e.jsx("div",{className:"space-y-4",children:x.slice(0,10).map(s=>e.jsx(_,{repair:s,getStatusColor:v,getActionButton:y},s.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"fas fa-history text-6xl text-slate-600 mb-4"}),e.jsx("p",{className:"text-slate-400 text-lg",children:"אין היסטוריית תיקונים"}),e.jsx("p",{className:"text-slate-500 text-sm mb-6",children:"התיקונים שלך יופיעו כאן"}),e.jsxs("a",{href:"/customer/report/",className:"bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-lg transition-colors duration-200 inline-flex items-center",children:[e.jsx("i",{className:"fas fa-wrench ml-2"}),"דווח על תקלה ראשונה"]})]})]})]})]})}function m({icon:t,title:i,value:c,color:n}){const o={blue:"from-blue-500/20 to-blue-600/20 border-blue-500/30 text-blue-400",purple:"from-purple-500/20 to-purple-600/20 border-purple-500/30 text-purple-400",green:"from-green-500/20 to-green-600/20 border-green-500/30 text-green-400",red:"from-red-500/20 to-red-600/20 border-red-500/30 text-red-400"};return e.jsx("div",{className:`bg-gradient-to-br ${o[n]} backdrop-blur-sm border rounded-xl p-6`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-300 text-sm mb-1",children:i}),e.jsx("p",{className:`text-3xl font-bold ${o[n].split(" ")[2]}`,children:c})]}),e.jsx("div",{className:`w-12 h-12 bg-gradient-to-br ${o[n]} rounded-xl flex items-center justify-center`,children:e.jsx("i",{className:`${t} ${o[n].split(" ")[2]} text-xl`})})]})})}function h({icon:t,title:i,description:c,href:n,color:o}){return e.jsx("a",{href:n,className:`block ${o} hover:scale-105 rounded-xl p-6 shadow-lg hover:shadow-xl transition-all duration-200`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx("i",{className:`${t} text-white text-xl`})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xl font-bold text-white mb-2",children:i}),e.jsx("p",{className:"text-white/80",children:c})]})]})})}function _({repair:t,getStatusColor:i,getActionButton:c}){return e.jsx("div",{className:"bg-slate-700/30 border border-slate-600 rounded-lg p-4 hover:bg-slate-700/50 transition-colors duration-200",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsxs("span",{className:"text-blue-300 font-medium",children:["#",t.id]}),e.jsx("span",{className:"mx-2 text-slate-500",children:"•"}),e.jsxs("span",{className:"text-white font-medium",children:[t.bike_info?.brand," ",t.bike_info?.model]})]}),t.problem_description&&e.jsx("p",{className:"text-slate-400 text-sm mb-2",children:t.problem_description.length>80?t.problem_description.substring(0,80)+"...":t.problem_description}),e.jsxs("div",{className:"flex items-center text-sm text-slate-500 mb-2",children:[e.jsx("i",{className:"fas fa-calendar ml-1"}),new Date(t.created_at).toLocaleDateString("he-IL")]}),t.progress_percentage>0&&e.jsxs("div",{className:"flex items-center text-sm text-slate-400",children:[e.jsx("i",{className:"fas fa-tasks ml-1"}),"התקדמות: ",Math.round(t.progress_percentage),"%",e.jsx("div",{className:"w-16 h-2 bg-slate-600 rounded-full ml-2",children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all duration-300",style:{width:`${t.progress_percentage}%`}})})]})]}),e.jsxs("div",{className:"text-left",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${i(t.status)}`,children:t.status_display}),c(t)]})]})})}const k=document.getElementById("customer-dashboard-root");k&&C.createRoot(k).render(e.jsx(R,{}));
//# sourceMappingURL=customer-dashboard.js.map
