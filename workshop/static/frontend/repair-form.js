import{c as M,j as e,r}from"./client.CZIp3qzo.js";import"./react-vendor.CiW5Bwbg.js";const Q=({selectedCustomerId:o=null})=>{const[f,b]=r.useState(""),[k,p]=r.useState([]),[C,u]=r.useState(!1),[c,E]=r.useState(null),[_,g]=r.useState([]),[D,j]=r.useState(!1),[d,N]=r.useState(null),[F,I]=r.useState([]),[m,L]=r.useState(new Set),[l,R]=r.useState([]),[n,q]=r.useState(""),[x,O]=r.useState(""),[$,v]=r.useState(!1),[B,i]=r.useState(""),w=r.useRef(null);r.useEffect(()=>{U()},[]),r.useEffect(()=>{o&&J(o)},[o]),r.useEffect(()=>{const s={selectedCustomer:c,selectedBike:d,selectedSubcategories:l,problemDescription:n,diagnosis:x};localStorage.setItem("repair_form_backup",JSON.stringify(s))},[c,d,l,n,x]);const U=async()=>{try{const t=await(await fetch("/api/categories/",{credentials:"same-origin"})).json();I(t)}catch(s){console.error("Error fetching categories:",s),i("שגיאה בטעינת קטגוריות")}},Y=s=>{const t=s.target.value;if(b(t),w.current&&clearTimeout(w.current),t.trim().length<2){p([]);return}u(!0),w.current=setTimeout(()=>{z(t)},300)},z=async s=>{try{const a=await(await fetch(`/api/search-customers/?q=${encodeURIComponent(s)}`,{credentials:"same-origin"})).json();p(a.customers||[]),u(!1)}catch(t){console.error("Error searching customers:",t),i("שגיאה בחיפוש לקוחות"),u(!1)}},J=async s=>{try{const a=await(await fetch(`/api/search-customers/?id=${s}`,{credentials:"same-origin"})).json();a.customers&&a.customers.length>0&&T(a.customers[0])}catch(t){console.error("Error loading customer:",t)}},T=s=>{E(s),p([]),b(""),s.bikes_count>0?V(s.id):g([])},P=()=>{E(null),g([]),N(null),b("")},V=async s=>{j(!0);try{const a=await(await fetch(`/api/customer-bikes/${s}/`,{credentials:"same-origin"})).json();g(a.bikes||[]),a.bikes&&a.bikes.length===1&&N(a.bikes[0]),j(!1)}catch(t){console.error("Error loading bikes:",t),i("שגיאה בטעינת אופניים"),j(!1)}},X=s=>{const t=new Set(m);if(t.has(s)){t.delete(s);const a=F.find(y=>y.id===s);if(a){const y=a.subcategories.map(S=>S.id);R(S=>S.filter(K=>!y.includes(K)))}}else t.add(s);L(t)},A=s=>{R(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s])},G=async s=>{if(s.preventDefault(),!d){i("נא לבחור אופניים");return}if(l.length===0&&!n.trim()){i("נא לבחור לפחות קטגוריה אחת או לכתוב תיאור בעיה");return}v(!0),i("");try{const a=await(await fetch("/api/repair/submit/",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":document.querySelector("[name=csrfmiddlewaretoken]").value},credentials:"same-origin",body:JSON.stringify({bike_id:d.id,subcategory_ids:l,problem_description:n,diagnosis:x})})).json();a.success?(localStorage.removeItem("repair_form_backup"),a.redirect_to_diagnosis?window.location.href=`/manager/repair/${a.repair_id}/diagnosis/`:window.location.href="/manager/dashboard/"):(i(a.error||"שגיאה בשמירת התיקון"),v(!1))}catch(t){console.error("Error submitting repair:",t),i("שגיאה בשמירת התיקון"),v(!1)}},H=()=>d&&(l.length>0||n.trim());return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900",children:[e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8",children:[e.jsxs("div",{className:"text-center mb-6 sm:mb-8",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl lg:text-5xl font-bold mb-4 bg-gradient-to-r from-blue-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent",children:"🔧 הוסף תיקון אופניים ⚙️"}),e.jsx("p",{className:"text-slate-300 text-base sm:text-lg max-w-2xl mx-auto",children:"צור תיקון חדש עם פרטי התקלה והאבחון המפורט"}),e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx("div",{className:"bg-slate-800/40 border border-blue-400/30 rounded-2xl px-4 py-2 backdrop-blur-xl",children:e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded-full"}),e.jsx("span",{className:"text-blue-300 font-medium",children:"טופס חדש"})]}),e.jsx("i",{className:"fas fa-chevron-left text-slate-400"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-slate-600 rounded-full"}),e.jsx("span",{className:"text-slate-400",children:"אבחון"})]}),e.jsx("i",{className:"fas fa-chevron-left text-slate-400"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-slate-600 rounded-full"}),e.jsx("span",{className:"text-slate-400",children:"ביצוע"})]})]})})})]}),B&&e.jsx("div",{className:"mb-6 p-4 bg-red-500/10 border border-red-400/30 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-300",children:[e.jsx("i",{className:"fas fa-exclamation-triangle"}),e.jsx("span",{children:B})]})}),e.jsxs("form",{onSubmit:G,className:"space-y-6",children:[e.jsxs("div",{className:"glass-card",children:[e.jsx("div",{className:"border-b border-slate-600/30 p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 sm:w-12 sm:h-12 bg-green-500/20 rounded-xl flex items-center justify-center",children:e.jsx("i",{className:"fas fa-search text-green-400 text-lg sm:text-xl"})}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-white",children:"חיפוש לקוח"})]})}),e.jsx("div",{className:"p-4 sm:p-6",children:c?e.jsx("div",{className:"bg-green-500/10 border border-green-400/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-500/20 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fas fa-user text-green-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-semibold",children:c.name}),e.jsx("div",{className:"text-green-300 text-sm",children:c.phone||"אין טלפון"})]})]}),e.jsx("button",{type:"button",onClick:P,className:"text-slate-400 hover:text-white transition-colors",children:e.jsx("i",{className:"fas fa-times"})})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"block text-white font-semibold mb-3 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-user text-green-400"}),"חפש לקוח לפי שם, טלפון או מספר לקוח"]}),e.jsx("input",{type:"text",value:f,onChange:Y,className:"w-full bg-slate-700/50 border border-slate-600 text-white placeholder-slate-400 rounded-xl px-4 py-3 focus:border-green-400 focus:ring-2 focus:ring-green-400/20 transition-all",placeholder:"הקלד שם לקוח, מספר טלפון או מספר לקוח...",autoComplete:"off"}),C&&e.jsxs("div",{className:"mt-4 bg-slate-700/50 border border-slate-600 rounded-xl p-4 text-center",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-slate-400 mr-2"}),e.jsx("span",{className:"text-slate-300",children:"מחפש לקוחות..."})]}),!C&&k.length>0&&e.jsx("div",{className:"mt-4 space-y-2",children:k.map(s=>e.jsx("div",{onClick:()=>T(s),className:"bg-slate-700/50 border border-slate-600 hover:border-green-400/50 rounded-xl p-4 cursor-pointer transition-all hover:bg-slate-600/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-500/20 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fas fa-user text-green-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-semibold",children:s.name}),e.jsxs("div",{className:"text-slate-300 text-sm",children:[s.phone&&e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-phone mr-1"}),s.phone]}),s.customer_number&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-2",children:"•"}),e.jsx("i",{className:"fas fa-hashtag mr-1"}),s.customer_number]})]})]})]}),e.jsxs("div",{className:"text-blue-300 text-sm",children:[e.jsx("i",{className:"fas fa-bicycle mr-1"}),s.bikes_count," אופניים"]})]})},s.id))})]})})]}),e.jsxs("div",{className:"glass-card",children:[e.jsx("div",{className:"border-b border-slate-600/30 p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 sm:w-12 sm:h-12 bg-blue-500/20 rounded-xl flex items-center justify-center",children:e.jsx("i",{className:"fas fa-bicycle text-blue-400 text-lg sm:text-xl"})}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-white",children:"בחירת אופניים"})]})}),e.jsx("div",{className:"p-4 sm:p-6",children:c?D?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-slate-400 text-2xl mb-2"}),e.jsx("p",{className:"text-slate-300",children:"טוען אופניים..."})]}):_.length===0?e.jsxs("div",{className:"bg-amber-500/10 border border-amber-400/30 rounded-xl p-4 text-center",children:[e.jsx("i",{className:"fas fa-bicycle text-amber-400 text-2xl mb-2"}),e.jsx("div",{className:"text-amber-300 font-semibold",children:"ללקוח אין אופניים רשומים"}),e.jsx("div",{className:"text-amber-200 text-sm mt-1",children:"יש להוסיף אופניים תחילה"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"block text-white font-semibold mb-3 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-bicycle text-blue-400"}),"בחר אופניים לתיקון"]}),e.jsx("div",{className:"space-y-3",children:_.map(s=>e.jsx("div",{onClick:()=>N(s),className:`bg-slate-700/50 border rounded-xl p-4 cursor-pointer transition-all ${d?.id===s.id?"border-blue-400 bg-blue-500/10":"border-slate-600 hover:border-blue-400/50"}`,children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500/20 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fas fa-bicycle text-blue-400"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-white font-semibold",children:[s.brand," ",s.model]}),e.jsxs("div",{className:"text-slate-300 text-sm",children:[e.jsx("i",{className:"fas fa-palette mr-1"}),s.color,s.serial_number&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-2",children:"•"}),e.jsx("i",{className:"fas fa-barcode mr-1"}),s.serial_number]})]})]})]})})},s.id))})]}):e.jsxs("div",{className:"text-center py-8 text-slate-400",children:[e.jsx("i",{className:"fas fa-info-circle text-4xl mb-4"}),e.jsx("p",{children:"בחר לקוח תחילה כדי לראות את האופניים שלו"})]})})]}),e.jsxs("div",{className:"glass-card",children:[e.jsx("div",{className:"border-b border-slate-600/30 p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 sm:w-12 sm:h-12 bg-amber-500/20 rounded-xl flex items-center justify-center",children:e.jsx("i",{className:"fas fa-tools text-amber-400 text-lg sm:text-xl"})}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-white",children:"קטגוריות התקלה"})]})}),e.jsx("div",{className:"p-4 sm:p-6",children:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:F.map(s=>e.jsx("div",{className:"category-item",children:e.jsxs("div",{className:`bg-slate-700/30 border rounded-xl overflow-hidden transition-all ${m.has(s.id)?"border-amber-400/50 bg-amber-500/5":"border-slate-600/40"}`,children:[e.jsx("div",{className:"p-4 border-b border-slate-600/30 cursor-pointer",onClick:()=>X(s.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-folder text-amber-400"}),e.jsx("span",{className:"text-white font-medium",children:s.name})]}),e.jsx("i",{className:`fas fa-chevron-down text-slate-400 transition-transform ${m.has(s.id)?"rotate-180":""}`})]})}),m.has(s.id)&&e.jsx("div",{className:"p-4 space-y-3",children:s.subcategories.map(t=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-all ${l.includes(t.id)?"bg-green-500/10 border border-green-400/50":"bg-slate-800/50 border border-slate-600/30 hover:border-green-400/50"}`,children:[e.jsx("input",{type:"checkbox",checked:l.includes(t.id),onChange:()=>A(t.id),className:"sr-only"}),e.jsx("div",{className:`w-4 h-4 rounded border-2 flex items-center justify-center transition-all ${l.includes(t.id)?"bg-green-500 border-green-500":"bg-slate-600 border-slate-500"}`,children:l.includes(t.id)&&e.jsx("i",{className:"fas fa-check text-white text-xs"})}),e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("i",{className:"fas fa-wrench text-green-400 text-sm"}),e.jsx("span",{className:"text-slate-200 text-sm",children:t.name})]})]},t.id))})]})},s.id))})})]}),e.jsxs("div",{className:"glass-card",children:[e.jsx("div",{className:"border-b border-slate-600/30 p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 sm:w-12 sm:h-12 bg-purple-500/20 rounded-xl flex items-center justify-center",children:e.jsx("i",{className:"fas fa-edit text-purple-400 text-lg sm:text-xl"})}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-white",children:"תיאור התקלה"})]})}),e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("label",{className:"block text-white font-semibold mb-3 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-comment-alt text-purple-400"}),"תיאור התקלה (חופשי)"]}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:n,onChange:s=>q(s.target.value),className:"w-full bg-slate-700/50 border border-slate-600 text-white placeholder-slate-400 rounded-xl px-4 py-3 pb-8 focus:border-purple-400 focus:ring-2 focus:ring-purple-400/20 transition-all resize-vertical min-h-[100px]",placeholder:"תאר את הבעיה...",maxLength:500}),e.jsxs("div",{className:"absolute bottom-3 left-3 text-xs text-slate-400",children:[n.length," / 500 תווים"]})]})]})]}),e.jsxs("div",{className:"glass-card",children:[e.jsx("div",{className:"border-b border-slate-600/30 p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 sm:w-12 sm:h-12 bg-emerald-500/20 rounded-xl flex items-center justify-center",children:e.jsx("i",{className:"fas fa-stethoscope text-emerald-400 text-lg sm:text-xl"})}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-white",children:"אבחון ופתרון"})]})}),e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("label",{className:"block text-white font-semibold mb-3 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-microscope text-emerald-400"}),"אבחון (אופציונלי)"]}),e.jsx("textarea",{value:x,onChange:s=>O(s.target.value),className:"w-full bg-slate-700/50 border border-slate-600 text-white placeholder-slate-400 rounded-xl px-4 py-3 focus:border-emerald-400 focus:ring-2 focus:ring-emerald-400/20 transition-all resize-vertical min-h-[100px]",placeholder:"פרט אבחון..."}),e.jsx("div",{className:"mt-4 p-4 bg-blue-500/10 border border-blue-400/30 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("i",{className:"fas fa-info-circle text-blue-400 mt-0.5"}),e.jsx("div",{className:"text-blue-200 text-sm leading-relaxed",children:"אם תמלא אבחון כאן, תועבר ישירות לדף האבחון המפורט כדי להוסיף פעולות תיקון ספציפיות עם מחירים"})]})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center pt-6",children:[e.jsx("button",{type:"submit",disabled:!H()||$,className:"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold py-4 px-8 rounded-xl transition-all shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none order-2 sm:order-1",children:$?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"שומר..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-save mr-2"}),"שמור תיקון"]})}),e.jsxs("a",{href:"/manager/dashboard/",className:"bg-slate-600/50 hover:bg-slate-600/70 text-slate-200 font-semibold py-4 px-8 rounded-xl transition-all text-center border border-slate-500/30 hover:border-slate-400/50 order-1 sm:order-2",children:[e.jsx("i",{className:"fas fa-times mr-2"}),"ביטול"]})]})]})]}),e.jsx("style",{children:`
        .glass-card {
          background: rgba(15, 23, 42, 0.4);
          backdrop-filter: blur(16px);
          border: 1px solid rgba(71, 85, 105, 0.3);
          border-radius: 1rem;
          box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
          animation: fadeInUp 0.6s ease-out forwards;
          overflow: hidden;
        }

        .glass-card:hover {
          background: rgba(15, 23, 42, 0.5);
          transform: translateY(-2px);
          transition: all 0.3s ease;
        }

        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        .sr-only {
          position: absolute;
          width: 1px;
          height: 1px;
          padding: 0;
          margin: -1px;
          overflow: hidden;
          clip: rect(0, 0, 0, 0);
          white-space: nowrap;
          border-width: 0;
        }
      `})]})},h=document.getElementById("root");if(h){const o=M.createRoot(h),f=h.dataset.customerId?parseInt(h.dataset.customerId):null;o.render(e.jsx(Q,{selectedCustomerId:f}))}
//# sourceMappingURL=repair-form.js.map
