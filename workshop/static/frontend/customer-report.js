import{c as T,j as e,r}from"./client.CZIp3qzo.js";import"./react-vendor.CiW5Bwbg.js";const O=()=>{const[c,p]=r.useState([]),[j,N]=r.useState([]),[o,d]=r.useState(""),[n,v]=r.useState([]),[m,w]=r.useState(!1),[x,S]=r.useState(""),[k,b]=r.useState(!0),[u,y]=r.useState(null),[i,h]=r.useState(!1),[g,C]=r.useState([]);r.useEffect(()=>{E()},[]);const E=async()=>{try{const[t,s]=await Promise.all([fetch("/api/customer/bikes/",{credentials:"same-origin"}),fetch("/api/categories/",{credentials:"same-origin"})]);if(!t.ok||!s.ok)throw new Error("Failed to fetch data");const a=await t.json(),B=await s.json();p(a),N(B),a.length===1&&d(a[0].id.toString()),b(!1)}catch(t){y(t.message),b(!1)}},R=t=>{C(s=>s.includes(t)?s.filter(a=>a!==t):[...s,t])},F=t=>{v(s=>s.includes(t)?s.filter(a=>a!==t):[...s,t])},l=()=>o&&(n.length>0||m),D=async t=>{if(t.preventDefault(),!!l()){h(!0);try{if(!(await fetch("/api/customer/report/",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRFToken":document.querySelector("[name=csrfmiddlewaretoken]")?.value||""},body:JSON.stringify({bike:o,subcategories:n,problem_description:x})})).ok)throw new Error("Failed to submit report");window.location.href="/customer/report/done/"}catch(s){alert("שגיאה בשליחת הדיווח: "+s.message),h(!1)}}};return k?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-400 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-slate-300 text-lg",children:"טוען..."})]})}):u?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:e.jsxs("div",{className:"bg-red-900/20 border border-red-500/30 rounded-2xl p-8 max-w-md mx-auto",children:[e.jsx("i",{className:"fas fa-exclamation-triangle text-red-400 text-4xl mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"שגיאה בטעינת הנתונים"}),e.jsx("p",{className:"text-red-200",children:u})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 py-8 px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-white mb-4",children:"🔧 דיווח תקלה חדשה"}),e.jsx("p",{className:"text-slate-300 text-lg",children:"תאר את התקלה בפירוט ונטפל בה בהקדם"})]}),e.jsx("div",{className:"bg-slate-800/80 border border-slate-600 rounded-2xl p-6 mb-6",children:e.jsxs("form",{onSubmit:D,children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-white font-bold mb-3 text-lg",children:"בחר אופניים:"}),e.jsxs("select",{value:o,onChange:t=>d(t.target.value),className:"w-full bg-slate-700 border border-slate-600 text-white rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"בחר אופניים"}),c.map(t=>e.jsxs("option",{value:t.id,children:[t.brand," ",t.model]},t.id))]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-white font-bold mb-4 text-lg",children:"בחר סוגי התקלות:"}),e.jsx("div",{className:"space-y-3",children:j.map(t=>e.jsxs("div",{className:"bg-slate-700/50 border border-slate-600 rounded-xl overflow-hidden",children:[e.jsxs("div",{onClick:()=>R(t.id),className:"bg-gradient-to-r from-blue-600/30 to-blue-500/30 px-4 py-3 cursor-pointer flex items-center justify-between hover:from-blue-600/40 hover:to-blue-500/40 transition-all duration-300",children:[e.jsxs("h3",{className:"text-blue-300 font-bold text-lg flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-tools text-blue-400"}),t.name]}),e.jsx("i",{className:`fas fa-chevron-down transition-transform duration-300 text-blue-300 ${g.includes(t.id)?"rotate-180":""}`})]}),g.includes(t.id)&&e.jsx("div",{className:"bg-slate-800/30 p-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:t.subcategories.map(s=>e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-700/30 rounded-lg hover:bg-slate-600/40 transition-colors cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.includes(s.id),onChange:()=>F(s.id),className:"w-4 h-4 text-blue-600 bg-slate-700 border-slate-500 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-white text-sm",children:s.name})]},s.id))})})]},t.id))})]}),e.jsxs("div",{className:"bg-amber-500/20 border border-amber-400/40 rounded-xl p-4 mb-6",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer text-white",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:t=>w(t.target.checked),className:"w-5 h-5 text-amber-500 bg-slate-700 border-slate-500 rounded focus:ring-amber-500"}),e.jsx("span",{className:"font-semibold",children:"לא מצאתי את התקלה שלי ברשימה"})]}),e.jsx("p",{className:"text-slate-300 text-sm mt-2 mr-8",children:"בחר באפשרות זו אם התקלה שלך לא מופיעה ברשימת הקטגוריות"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-white font-bold mb-3 text-lg",children:"תיאור התקלה:"}),e.jsx("textarea",{value:x,onChange:t=>S(t.target.value),className:"w-full bg-slate-700 border border-slate-600 text-white rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent min-h-[120px] resize-vertical",placeholder:"תאר את התקלה בפירוט..."})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("button",{type:"submit",disabled:!l()||i,className:`px-8 py-4 text-lg font-bold rounded-xl transition-all duration-300 shadow-lg ${l()&&!i?"bg-gradient-to-r from-green-500 to-green-600 text-white hover:from-green-600 hover:to-green-700 transform hover:scale-105 cursor-pointer":"bg-gradient-to-r from-slate-500 to-slate-600 text-slate-300 cursor-not-allowed"}`,children:i?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"שולח..."]}):"שלח דיווח תקלה"}),!l()&&e.jsxs("div",{className:"bg-blue-500/10 border border-blue-400/30 rounded-xl p-4 mt-4 text-blue-200",children:[e.jsx("div",{className:"font-semibold mb-2",children:"כדי לשלוח דיווח:"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsx("div",{children:"• בחר אופניים מהרשימה"}),e.jsx("div",{children:'• בחר קטגוריות תקלה או סמן "לא מצאתי את התקלה שלי"'})]})]})]})]})})]})})},f=document.getElementById("root");f&&T.createRoot(f).render(e.jsx(O,{}));
//# sourceMappingURL=customer-report.js.map
