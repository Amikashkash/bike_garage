{% extends "workshop/base.html" %}

{% block title %}×¨×©×™××ª ×œ×§×•×—×•×ª{% endblock %}

{% block content %}
<div style="max-width: 1000px; margin: 0 auto;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>ğŸ‘¥ ×¨×©×™××ª ×œ×§×•×—×•×ª</h2>
        <div style="display: flex; gap: 10px;">
            <a href="{% url 'customer_form' %}" style="background-color: #007bff; color: white; padding: 10px 15px; text-decoration: none; border-radius: 5px;">
                â• ×”×•×¡×£ ×œ×§×•×— ×—×“×©
            </a>
            <a href="{% url 'customer_with_bike_new' %}" style="background-color: #28a745; color: white; padding: 10px 15px; text-decoration: none; border-radius: 5px;">
                ğŸ‘¥ğŸš² ×œ×§×•×— + ××•×¤× ×™×™×
            </a>
        </div>
    </div>

    <!-- ×œ×§×•×—×•×ª ×¢× ×—×©×‘×•×Ÿ ××©×ª××© -->
    <div style="margin-bottom: 30px;">
        <h3 style="color: #28a745;">ğŸŸ¢ ×œ×§×•×—×•×ª ×¨×©×•××™× ×‘××¢×¨×›×ª ({{ customers_with_user.count }})</h3>
        <p style="color: #666; font-size: 0.9em;">×œ×§×•×—×•×ª ×©× ×¨×©××• ×‘×¢×¦×× ×•×™×›×•×œ×™× ×œ×”×ª×—×‘×¨ ×œ××¢×¨×›×ª</p>
        
        {% if customers_with_user %}
        <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6;">
            {% for customer in customers_with_user %}
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; margin-bottom: 15px; background-color: white; border-radius: 8px; border: 1px solid #4caf50; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <div style="flex-grow: 1;">
                    <strong style="font-size: 1.1em;">{{ customer.name }}</strong>
                    <br>
                    <small style="color: #666;">
                        ğŸ“ {{ customer.phone }} 
                        {% if customer.email %}| ğŸ“§ {{ customer.email }}{% endif %}
                        | ğŸ‘¤ {{ customer.user.username }}
                    </small>
                    {% with customer.bikes.all as bikes %}
                        {% if bikes %}
                            <br>
                            <small style="color: #2196f3;">
                                ğŸš² {{ bikes.count }} ××•×¤× ×™×™×: 
                                {% for bike in bikes %}
                                    {{ bike.brand }} {{ bike.model|default:"" }}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            </small>
                        {% else %}
                            <br>
                            <small style="color: #ff9800;">âš ï¸ ××™×Ÿ ××•×¤× ×™×™× ×¨×©×•××•×ª</small>
                        {% endif %}
                    {% endwith %}
                </div>
                <div style="display: flex; gap: 10px;">
                    <span style="background-color: #4caf50; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8em;">
                        âœ… ×¨×©×•×
                    </span>
                    {% with customer.bikes.first as first_bike %}
                        {% if first_bike %}
                            <a href="{% url 'customer_with_bike_edit' customer.id first_bike.id %}" 
                               style="background-color: #2196f3; color: white; padding: 6px 12px; text-decoration: none; border-radius: 4px; font-size: 0.9em;">
                                âœï¸ ×¢×¨×•×š
                            </a>
                        {% else %}
                            <a href="{% url 'customer_bike_add' customer.id %}" 
                               style="background-color: #ff9800; color: white; padding: 6px 12px; text-decoration: none; border-radius: 4px; font-size: 0.9em;">
                                â• ×”×•×¡×£ ××•×¤× ×™×™×
                            </a>
                        {% endif %}
                    {% endwith %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p style="color: #666; font-style: italic;">××™×Ÿ ×œ×§×•×—×•×ª ×¨×©×•××™× ×¢×“×™×™×Ÿ</p>
        {% endif %}
    </div>

    <!-- ×œ×§×•×—×•×ª ×œ×œ× ×—×©×‘×•×Ÿ ××©×ª××© -->
    <div>
        <h3 style="color: #ffc107;">ğŸŸ¡ ×¤×¨×˜×™ ×§×©×¨ ×‘×œ×‘×“ ({{ customers_without_user.count }})</h3>
        <p style="color: #666; font-size: 0.9em;">×œ×§×•×—×•×ª ×©× ×•×¦×¨×• ×¢"×™ ×”×× ×”×œ - ×œ×œ× ××¤×©×¨×•×ª ×”×ª×—×‘×¨×•×ª</p>
        
        {% if customers_without_user %}
        <div style="background-color: #fff8e1; padding: 15px; border-radius: 8px; border: 1px solid #ffe0b2;">
            {% for customer in customers_without_user %}
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; margin-bottom: 15px; background-color: white; border-radius: 8px; border: 1px solid #ffcc02; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <div style="flex-grow: 1;">
                    <strong style="font-size: 1.1em;">{{ customer.name }}</strong>
                    <br>
                    <small style="color: #666;">
                        ğŸ“ {{ customer.phone }} 
                        {% if customer.email %}| ğŸ“§ {{ customer.email }}{% endif %}
                    </small>
                    {% with customer.bikes.all as bikes %}
                        {% if bikes %}
                            <br>
                            <small style="color: #2196f3;">
                                ğŸš² {{ bikes.count }} ××•×¤× ×™×™×: 
                                {% for bike in bikes %}
                                    {{ bike.brand }} {{ bike.model|default:"" }}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            </small>
                        {% else %}
                            <br>
                            <small style="color: #ff9800;">âš ï¸ ××™×Ÿ ××•×¤× ×™×™× ×¨×©×•××•×ª</small>
                        {% endif %}
                    {% endwith %}
                </div>
                <div style="display: flex; gap: 10px;">
                    <span style="background-color: #ff8f00; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8em;">
                        âš ï¸ ×¤×¨×˜×™ ×§×©×¨
                    </span>
                    {% with customer.bikes.first as first_bike %}
                        {% if first_bike %}
                            <a href="{% url 'customer_with_bike_edit' customer.id first_bike.id %}" 
                               style="background-color: #2196f3; color: white; padding: 6px 12px; text-decoration: none; border-radius: 4px; font-size: 0.9em;">
                                âœï¸ ×¢×¨×•×š
                            </a>
                        {% else %}
                            <a href="{% url 'customer_bike_add' customer.id %}" 
                               style="background-color: #ff9800; color: white; padding: 6px 12px; text-decoration: none; border-radius: 4px; font-size: 0.9em;">
                                â• ×”×•×¡×£ ××•×¤× ×™×™×
                            </a>
                        {% endif %}
                    {% endwith %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p style="color: #666; font-style: italic;">××™×Ÿ ×¤×¨×˜×™ ×§×©×¨ ×©× ×•×¦×¨×• ×¢"×™ ×”×× ×”×œ</p>
        {% endif %}
    </div>

    <!-- ×”×¡×‘×¨ -->
    <div style="margin-top: 30px; padding: 15px; background-color: #e3f2fd; border-radius: 8px; border: 1px solid #bbdefb;">
        <h4>ğŸ’¡ ×”×¡×‘×¨ ×¢×œ ×¡×•×’×™ ×”×œ×§×•×—×•×ª:</h4>
        <ul style="margin: 10px 0;">
            <li><strong>×œ×§×•×—×•×ª ×¨×©×•××™× (×™×¨×•×§):</strong> × ×¨×©××• ×‘×¢×¦×× ×“×¨×š ×“×£ ×”×”×¨×©××”, ×™×›×•×œ×™× ×œ×”×ª×—×‘×¨ ×•×œ×“×•×•×— ×ª×§×œ×•×ª</li>
            <li><strong>×¤×¨×˜×™ ×§×©×¨ (×¦×”×•×‘):</strong> × ×•×¦×¨×• ×¢"×™ ×”×× ×”×œ/××›×•× ××™, ××©××©×™× ×¨×§ ×œ×ª×™×¢×•×“ ×•×™×¦×™×¨×ª ×ª×™×§×•× ×™×</li>
        </ul>
        <p style="margin: 10px 0; color: #1565c0;">
            <strong>×”××œ×¦×”:</strong> ×¢×•×“×“ ×œ×§×•×—×•×ª ×œ×”×™×¨×©× ×‘×¢×¦×× ×›×“×™ ×©×™×•×›×œ×• ×œ×¢×§×•×‘ ××—×¨ ×”×ª×™×§×•× ×™× ×•×œ×“×•×•×— ×ª×§×œ×•×ª.
        </p>
    </div>
</div>
{% endblock %}
